"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4747],{5318:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>u,toc:()=>d});var t=a(4848),r=a(8453),o=a(1470),s=a(9365);const i={sidebar_position:4},l="Prepare Your Database",u={id:"tutorial-basics/prepare-your-database",title:"Prepare Your Database",description:"Configure your database for use with Nodestream.",source:"@site/docs/tutorial-basics/prepare-your-database.mdx",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/prepare-your-database",permalink:"/docs/docs/tutorial-basics/prepare-your-database",draft:!1,unlisted:!1,editUrl:"https://github.com/nodesteram-proj/docs/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-basics/prepare-your-database.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Create A New Pipeline",permalink:"/docs/docs/tutorial-basics/create-a-new-pipeline"},next:{title:"Running The Pipeline",permalink:"/docs/docs/tutorial-basics/run-the-pipeline"}},c={},d=[{value:"Database Migrations",id:"database-migrations",level:2},{value:"Generating Database Migrations",id:"generating-database-migrations",level:2},{value:"Configuring Your Database Connection",id:"configuring-your-database-connection",level:2},{value:"Running Migrations",id:"running-migrations",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"prepare-your-database",children:"Prepare Your Database"}),"\n",(0,t.jsx)(n.p,{children:"Configure your database for use with Nodestream."}),"\n",(0,t.jsx)(n.p,{children:"In this tutorial, we'll walk you through preparing your database for use with Nodestream."}),"\n",(0,t.jsx)(n.h2,{id:"database-migrations",children:"Database Migrations"}),"\n",(0,t.jsxs)(n.p,{children:['Nodestream uses a concept called "database migrations" to manage changes to your database schema over time.\nDespite graph databases generally not having an enforced schema, ',(0,t.jsx)(n.code,{children:"nodestream"})," uses a schema to define the structure of your data.\nAdditionally, it uses migrations to suggest indexe and constraints to the database to improve performance and data integrity (e.g. unique constraints) where the database supports it.\nAs your application evolves, you'll need to make changes to your database schema to accommodate new features or bug fixes.\nIn nodestream this is achieved by making changes to your pipelines file.\nNodestream will then generate the necessary migrations for you."]}),"\n",(0,t.jsx)(n.h2,{id:"generating-database-migrations",children:"Generating Database Migrations"}),"\n",(0,t.jsx)(n.p,{children:"To generate a new migration, run the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nodestream migrations make\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When you run this command, Nodestream will generate a new migration file in the ",(0,t.jsx)(n.code,{children:"migrations"})," directory of your project.\nThe file will contain a list of operations that need to be performed to bring your database schema up to date.\nIn the case of a new project, the migration will contain the operations to create the initial schema."]}),"\n",(0,t.jsx)(n.p,{children:"The output of the command will look something like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:"Which will produce output like this:\n\nGenerated migration 20240209081151.\nThe migration contains 4 schema changes.\n  - Create node type Employee\n  - Add additional index for node type Employee on field last_ingested_at\n  - Create relationship type REPORTS_TO\n  - Add additional index for relationship type REPORTS_TO on field last_ingested_at\nMigration written to migrations/20240209081151.yaml\nRun `nodestream migrations run` to apply the migration.\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-your-database-connection",children:"Configuring Your Database Connection"}),"\n",(0,t.jsxs)(n.p,{children:["Before you can run the migrations or a pipeline, you'll need to configure your database connection.\nTo do this, open the ",(0,t.jsx)(n.code,{children:"nodestream.yaml"})," file in the root of your project and add you should see a section like this:"]}),"\n",(0,t.jsxs)(o.A,{defaultValue:"neo4j",values:[{label:"neo4j",value:"neo4j"},{label:"Amazon Neptune",value:"neptune"}],children:[(0,t.jsxs)(s.A,{value:"neo4j",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"targets:\n  my-db:\n    database: neo4j\n    password: neo4j123\n    uri: bolt://localhost:7687\n    username: neo4j\n"})}),(0,t.jsxs)(n.p,{children:["Replace the ",(0,t.jsx)(n.code,{children:"uri"}),", ",(0,t.jsx)(n.code,{children:"username"}),", and ",(0,t.jsx)(n.code,{children:"password"})," with the connection details for your database."]}),(0,t.jsx)(n.p,{children:"If you just want to get up and running quickly, you can use run this docker command to start a local Neo4j instance with the same default credentials:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'docker run \\\n    --restart always \\\n    --publish=7474:7474 --publish=7687:7687 \\\n    --env NEO4J_AUTH=neo4j/neo4j123 \\\n    --env NEO4J_PLUGINS=\'["apoc","bloom"]\' \\\n    neo4j:5\n'})}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"WARNING:"})," Do not use the default credentials or credentials that are stored in your source code in a production (or really any) environment. Always use environment variables or a secrets manager to store your credentials. Read more about this ",(0,t.jsx)(n.a,{href:"../../tutorials-intermediate/configuring-projects",children:"here"}),"."]})]}),(0,t.jsxs)(s.A,{value:"neptune",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"targets:\n  my-neptune-db:\n    database: neptune\n    mode: database\n    host: https://[NEPTUNE_ENDPOINT]:[PORT]\n  my-neptune-analytics:\n    database: neptune\n    mode: analytics\n    graph_id: [GRAPH_IDENTIFIER]\n"})}),(0,t.jsxs)(n.p,{children:["Set the ",(0,t.jsx)(n.code,{children:"mode"})," to your desired flavor of Neptune, and replace either the ",(0,t.jsx)(n.code,{children:"host"})," or ",(0,t.jsx)(n.code,{children:"graph_id"})," with the connection details for your database."]})]})]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.mdxAdmonitionTitle,{}),(0,t.jsxs)(n.p,{children:["Always check the database specific documentation for all prerequisites and configuration options ",(0,t.jsx)(n.a,{href:"../../category/database-support",children:"here"}),"."]})]}),"\n",(0,t.jsx)(n.h2,{id:"running-migrations",children:"Running Migrations"}),"\n",(0,t.jsx)(n.p,{children:"To run the migrations we just created, run the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nodestream migrations run --target my-db\n"})}),"\n",(0,t.jsx)(n.p,{children:"When you run this command, Nodestream will apply all pending migrations to your database and bring your schema up to date."}),"\n",(0,t.jsx)(n.p,{children:"The output of the command will look something like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:" - Migrations executed on target my-db.\n"})}),"\n",(0,t.jsx)(n.p,{children:"That's it! Your database is now ready to use with Nodestream."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},9365:(e,n,a)=>{a.d(n,{A:()=>s});a(6540);var t=a(4164);const r={tabItem:"tabItem_Ymn6"};var o=a(4848);function s(e){let{children:n,hidden:a,className:s}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,s),hidden:a,children:n})}},1470:(e,n,a)=>{a.d(n,{A:()=>w});var t=a(6540),r=a(4164),o=a(3104),s=a(6347),i=a(205),l=a(7485),u=a(1682),c=a(9466);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:a,attributes:t,default:r}}=e;return{value:n,label:a,attributes:t,default:r}}))}(a);return function(e){const n=(0,u.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function p(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:a}=e;const r=(0,s.W6)(),o=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,l.aZ)(o),(0,t.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})}),[o,r])]}function g(e){const{defaultValue:n,queryString:a=!1,groupId:r}=e,o=h(e),[s,l]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=a.find((e=>e.default))??a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:o}))),[u,d]=m({queryString:a,groupId:r}),[g,b]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,o]=(0,c.Dv)(a);return[r,(0,t.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:r}),f=(()=>{const e=u??g;return p({value:e,tabValues:o})?e:null})();(0,i.A)((()=>{f&&l(f)}),[f]);return{selectedValue:s,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)}),[d,b,o]),tabValues:o}}var b=a(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=a(4848);function x(e){let{className:n,block:a,selectedValue:t,selectValue:s,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),c=e=>{const n=e.currentTarget,a=l.indexOf(n),r=i[a].value;r!==t&&(u(n),s(r))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const a=l.indexOf(e.currentTarget)+1;n=l[a]??l[0];break}case"ArrowLeft":{const a=l.indexOf(e.currentTarget)-1;n=l[a]??l[l.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":a},n),children:i.map((e=>{let{value:n,label:a,attributes:o}=e;return(0,y.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>l.push(e),onKeyDown:d,onClick:c,...o,className:(0,r.A)("tabs__item",f.tabItem,o?.className,{"tabs__item--active":t===n}),children:a??n},n)}))})}function j(e){let{lazy:n,children:a,selectedValue:r}=e;const o=(Array.isArray(a)?a:[a]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function v(e){const n=g(e);return(0,y.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,y.jsx)(x,{...e,...n}),(0,y.jsx)(j,{...e,...n})]})}function w(e){const n=(0,b.A)();return(0,y.jsx)(v,{...e,children:d(e.children)},String(n))}},8453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>i});var t=a(6540);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);